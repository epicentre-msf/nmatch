<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compare sets of proper names accounting for common types of variation in format and style — nmatch • nmatch</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compare sets of proper names accounting for common types of variation in format and style — nmatch"><meta name="description" content='Compare proper names across two sources using string-standardization to
account for variation in punctuation, accents, and character case,
token-permutation to account for variation in name order, and fuzzy matching
to handle alternate spellings. The specific steps are:
Standardize strings. The default function is
name_standardize which removes accents and punctuation,
standardizes case, and removes extra whitespace. E.g. "Brontë, Emily J." is
standardized to "BRONTE EMILY J".
Tokenize standardized names, optionally retaining only tokens larger than
a given nchar limit.
For each pair of names, calculate string distance between all combinations
of tokens, and find the best overall token alignment (i.e. the alignment that
minimizes the summed string distance). If two names being compared differ in
their number of tokens, the alignment is made with respect to the smaller
number of tokens. E.g. If comparing "Angela Dorothea Merkel" to "Merkel
Angela", the token "Dorothea" would ultimately be omitted from the best
alignment.
For each pair of tokens in the best alignment, classify whether or not the
tokens match (TRUE/FALSE) based on their respective lengths and the string
distance between them.
Summarize the number of tokens in each name, the number of tokens in the
best alignment, the number of aligned tokens that match, and the summed
string distance of the best alignment.
Classify overall match status (TRUE/FALSE) based on the match details
described in (5). By default, two names are considered to be matching if two
or more tokens match across names (e.g. "Merkel Angela" matches "Angela
Dorothea Merkel"), or if both names consist of only a single token which is
matching (e.g. "Beyonce" matches "Beyoncé").

'><meta property="og:description" content='Compare proper names across two sources using string-standardization to
account for variation in punctuation, accents, and character case,
token-permutation to account for variation in name order, and fuzzy matching
to handle alternate spellings. The specific steps are:
Standardize strings. The default function is
name_standardize which removes accents and punctuation,
standardizes case, and removes extra whitespace. E.g. "Brontë, Emily J." is
standardized to "BRONTE EMILY J".
Tokenize standardized names, optionally retaining only tokens larger than
a given nchar limit.
For each pair of names, calculate string distance between all combinations
of tokens, and find the best overall token alignment (i.e. the alignment that
minimizes the summed string distance). If two names being compared differ in
their number of tokens, the alignment is made with respect to the smaller
number of tokens. E.g. If comparing "Angela Dorothea Merkel" to "Merkel
Angela", the token "Dorothea" would ultimately be omitted from the best
alignment.
For each pair of tokens in the best alignment, classify whether or not the
tokens match (TRUE/FALSE) based on their respective lengths and the string
distance between them.
Summarize the number of tokens in each name, the number of tokens in the
best alignment, the number of aligned tokens that match, and the summed
string distance of the best alignment.
Classify overall match status (TRUE/FALSE) based on the match details
described in (5). By default, two names are considered to be matching if two
or more tokens match across names (e.g. "Merkel Angela" matches "Angela
Dorothea Merkel"), or if both names consist of only a single token which is
matching (e.g. "Beyonce" matches "Beyoncé").

'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nmatch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epicentre-msf/nmatch/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compare sets of proper names accounting for common types of variation in format and style</h1>
      <small class="dont-index">Source: <a href="https://github.com/epicentre-msf/nmatch/blob/main/R/nmatch.R" class="external-link"><code>R/nmatch.R</code></a></small>
      <div class="d-none name"><code>nmatch.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compare proper names across two sources using string-standardization to
account for variation in punctuation, accents, and character case,
token-permutation to account for variation in name order, and fuzzy matching
to handle alternate spellings. The specific steps are:</p><ol><li><p>Standardize strings. The default function is
<code><a href="name_standardize.html">name_standardize</a></code> which removes accents and punctuation,
standardizes case, and removes extra whitespace. E.g. "Brontë, Emily J." is
standardized to "BRONTE EMILY J".</p></li>
<li><p>Tokenize standardized names, optionally retaining only tokens larger than
a given nchar limit.</p></li>
<li><p>For each pair of names, calculate string distance between all combinations
of tokens, and find the best overall token alignment (i.e. the alignment that
minimizes the summed string distance). If two names being compared differ in
their number of tokens, the alignment is made with respect to the smaller
number of tokens. E.g. If comparing "Angela Dorothea Merkel" to "Merkel
Angela", the token "Dorothea" would ultimately be omitted from the best
alignment.</p></li>
<li><p>For each pair of tokens in the best alignment, classify whether or not the
tokens match (TRUE/FALSE) based on their respective lengths and the string
distance between them.</p></li>
<li><p>Summarize the number of tokens in each name, the number of tokens in the
best alignment, the number of aligned tokens that match, and the summed
string distance of the best alignment.</p></li>
<li><p>Classify overall match status (TRUE/FALSE) based on the match details
described in (5). By default, two names are considered to be matching if two
or more tokens match across names (e.g. "Merkel Angela" matches "Angela
Dorothea Merkel"), or if both names consist of only a single token which is
matching (e.g. "Beyonce" matches "Beyoncé").</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nmatch</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  token_split <span class="op">=</span> <span class="st">"[-_[:space:]]+"</span>,</span>
<span>  nchar_min <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  dist_method <span class="op">=</span> <span class="st">"osa"</span>,</span>
<span>  std <span class="op">=</span> <span class="va">name_standardize</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  return_full <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_alignment <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  eval_fn_token <span class="op">=</span> <span class="va">match_eval_token</span>,</span>
<span>  eval_fn <span class="op">=</span> <span class="va">match_eval</span>,</span>
<span>  eval_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_match_crit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  token_freq <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x-y">x, y<a class="anchor" aria-label="anchor" href="#arg-x-y"></a></dt>
<dd><p>Vectors of proper names to compare. Must be of same length.</p></dd>


<dt id="arg-token-split">token_split<a class="anchor" aria-label="anchor" href="#arg-token-split"></a></dt>
<dd><p>Regex pattern to split strings into tokens. Defaults to
<code>"[-_[:space:]]+"</code>, which splits at each sequence of one more dash,
underscore, or space character.</p></dd>


<dt id="arg-nchar-min">nchar_min<a class="anchor" aria-label="anchor" href="#arg-nchar-min"></a></dt>
<dd><p>Minimum token size to compare. Defaults to <code>2L</code>.</p></dd>


<dt id="arg-dist-method">dist_method<a class="anchor" aria-label="anchor" href="#arg-dist-method"></a></dt>
<dd><p>Method to use for string distance calculation (see
<a href="https://rdrr.io/pkg/stringdist/man/stringdist-metrics.html" class="external-link">stringdist-metrics</a>). Defaults to <code>"osa"</code>.</p></dd>


<dt id="arg-std">std<a class="anchor" aria-label="anchor" href="#arg-std"></a></dt>
<dd><p>Function to standardize strings during matching. Defaults to
<code><a href="name_standardize.html">name_standardize</a></code>. Set to <code>NULL</code> to omit standardization.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments passed to <code>std()</code></p></dd>


<dt id="arg-return-full">return_full<a class="anchor" aria-label="anchor" href="#arg-return-full"></a></dt>
<dd><p>Logical indicating whether to return data frame with full
summary of match details (<code>TRUE</code>), or only a logical vector corresponding
to final match status (<code>FALSE</code>). Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-return-alignment">return_alignment<a class="anchor" aria-label="anchor" href="#arg-return-alignment"></a></dt>
<dd><p>Logical indicating whether to return additional list
column 'align' containing data frames with details on best alignment for
each pair of names. Defaults to <code>FALSE</code>. Only used if <code>return_full = TRUE</code>.
summary of match details (<code>TRUE</code>), or only a logical vector corresponding
to final match status (<code>FALSE</code>). Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-eval-fn-token">eval_fn_token<a class="anchor" aria-label="anchor" href="#arg-eval-fn-token"></a></dt>
<dd><p>Function to determine token match status. Defaults to
<code><a href="match_eval_token.html">match_eval_token</a></code>. See section <em>Custom classification
functions</em> for more details.</p></dd>


<dt id="arg-eval-fn">eval_fn<a class="anchor" aria-label="anchor" href="#arg-eval-fn"></a></dt>
<dd><p>Function to determine overall match status. Defaults to
<code><a href="match_eval.html">match_eval</a></code>. See section <em>Custom classification functions</em> for
more details.</p></dd>


<dt id="arg-eval-params">eval_params<a class="anchor" aria-label="anchor" href="#arg-eval-params"></a></dt>
<dd><p>List of additional arguments passed to <code>eval_fn</code></p></dd>


<dt id="arg-token-freq">token_freq<a class="anchor" aria-label="anchor" href="#arg-token-freq"></a></dt>
<dd><p>Optional data frame containing the frequencies of name
tokens within the population of interest. Must have two columns</p><ul><li><p>token_std: standardized tokens (using the same function as <code>std</code>)</p></li>
<li><p>freq: token frequency</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>return_full = FALSE</code> (the default), returns a logical vector indicating
which elements of <code>x</code> and <code>y</code> are matches.</p>
<p>If <code>return_full = TRUE</code>, returns a tibble-style data frame summarizing the
match details, including columns:</p><ul><li><p><code>is_match</code>: logical vector indicating overall match status</p></li>
<li><p><code>k_x</code>: number of tokens in <code>x</code> (excludes tokens smaller than <code>nchar_min</code>)</p></li>
<li><p><code>k_y</code>: number of tokens in <code>y</code> (excludes tokens smaller than <code>nchar_min</code>)</p></li>
<li><p><code>k_align</code>: number of aligned tokens (i.e. <code>min(k_x, k_y)</code>)</p></li>
<li><p><code>n_match</code>: number of aligned tokens that match (i.e. distance &lt;= <code>dist_max</code>)</p></li>
<li><p><code>dist_total</code>: summed string distance across aligned tokens</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">names1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"Angela Dorothea Merkel"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Emmanuel Jean-Michel Fr\u00e9d\u00e9ric Macron"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Mette Frederiksen"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Katrin Jakobsd\u00f3ttir"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"Pedro S\u00e1nchez P\u00e9rez-Castej\u00f3n"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">names2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"MERKEL, Angela"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"MACRON, Emmanuel J.-M. F."</span>,</span></span>
<span class="r-in"><span>  <span class="st">"FREDERICKSON, Mette"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"JAKOBSDOTTIR  Kathríne"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"PEREZ-CASTLEJON, Pedro"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># return logical vector specifying which names are matches</span></span></span>
<span class="r-in"><span><span class="fu">nmatch</span><span class="op">(</span><span class="va">names1</span>, <span class="va">names2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE TRUE TRUE TRUE TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># return data frame with full match details</span></span></span>
<span class="r-in"><span><span class="fu">nmatch</span><span class="op">(</span><span class="va">names1</span>, <span class="va">names2</span>, return_full <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   is_match    id   k_x   k_y k_align n_match dist_total freq_score</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> TRUE         1     3     2       2       2          0 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> TRUE         2     5     5       5       2         15 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> TRUE         3     2     2       2       2          2 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> TRUE         4     2     2       2       2          2 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> TRUE         5     4     3       3       3          1 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use a custom function to classify matches</span></span></span>
<span class="r-in"><span><span class="va">classify_matches</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">k_align</span>, <span class="va">n_match</span>, <span class="va">dist_total</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">n_match</span> <span class="op">==</span> <span class="va">k_align</span> <span class="op">&amp;</span> <span class="va">dist_total</span> <span class="op">&lt;</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">nmatch</span><span class="op">(</span><span class="va">names1</span>, <span class="va">names2</span>, return_full <span class="op">=</span> <span class="cn">TRUE</span>, eval_fn <span class="op">=</span> <span class="va">classify_matches</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   is_match    id   k_x   k_y k_align n_match dist_total freq_score</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> TRUE         1     3     2       2       2          0 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> FALSE        2     5     5       5       2         15 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> FALSE        3     2     2       2       2          2 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> FALSE        4     2     2       2       2          2 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> TRUE         5     4     3       3       3          1 <span style="color: #BB0000;">NA</span>        </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Barks.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

